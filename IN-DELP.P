DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XOPR AS CHAR FORMAT "XXX".
DEFINE VARIABLE XCUST AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR XPROP AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR XINV AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR XITEM AS INTEGER FORMAT "ZZZZ".
DEF VAR XFREQ AS CHAR FORMAT "X(25)".
DEF VAR ANS AS LOGICAL LABEL
 "DO YOU WISH TO DELETE THIS INVOICE ?".
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
REPEAT:
DISPLAY SPACE(24)
"I N V O I C E   S C R E E N         (DEL)"
SKIP(1)
    XCOM-N LABEL "CMP" SPACE(1)
    XDIV-N LABEL "DIV" SPACE(1)
    XOPR LABEL "OPR" SKIP(1) WITH FRAME X.
   PROMPT-FOR INVOICE.CUST# SPACE(3) INVOICE.ORD-NO SPACE(3) INVOICE.ITM-NO
	      WITH FRAME X COLOR DISPLAY NORMAL PROMPT W/MA.
   IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETURN.
   XINV = INPUT INVOICE.ORD-NO.
   XCUST = INPUT INVOICE.CUST#.
   XITEM = INPUT INVOICE.ITM-NO.
   FIND FIRST INVOICE WHERE INVOICE.COMP# = XCOM AND
			    INVOICE.DIV# = XDIV AND
			    INVOICE.CUST# = XCUST AND
			    INVOICE.ORD-NO = XINV AND
			    INVOICE.ITM-NO = XITEM NO-ERROR.
   IF NOT AVAILABLE INVOICE THEN DO:
       BELL.
       HIDE MESSAGE.
       MESSAGE COLOR BLINK
       "ORDER #" XINV "ITM #" XITEM "NOT CREATED FOR CUST #" XCUST.
       BELL.
       UNDO, RETRY.
   END.
 FIND FIRST ACCT-RCV WHERE ACCT-RCV.COMP# = XCOM AND ACCT-RCV.DIV# = XDIV AND
			   ACCT-RCV.CUST# = INVOICE.CUST# AND
			   ACCT-RCV.C-STATUS <> "I" NO-ERROR.
 IF NOT AVAILABLE ACCT-RCV THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS CUSTOMER DOES NOT EXIST OR IS INACTIVE".
     BELL.
     UNDO, RETRY.
 END.
 XFREQ = "".
 IF INVOICE.REC-TYPE = "R" THEN DO:
     FIND FIRST METDESC WHERE METDESC.COMP# = XCOM AND
			      METDESC.DIV# = XDIV AND
			      METDESC.CUST# = INVOICE.CUST# AND
			      METDESC.PROPSL# = INVOICE.PROPSL# AND
			      METDESC.ITEM# = INVOICE.ITEM# NO-ERROR.
     IF NOT AVAILABLE METDESC THEN DO:
	 HIDE MESSAGE.
	 BELL.
	 MESSAGE COLOR BLINK
	     "THIS ITEM # DOES NOT EXIST FOR PROPOSAL " INVOICE.PROPSL#.
     END.
 END.
 FIND FIRST METPRO WHERE METPRO.COMP# = XCOM AND METPRO.DIV# = XDIV AND
			 METPRO.CUST# = INVOICE.CUST# AND
			 METPRO.PROPSL# = INVOICE.PROPSL# NO-ERROR.
 IF NOT AVAILABLE METPRO THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS PROPOSAL DOES NOT EXIST".
     BELL.
     UNDO, RETRY.
 END.
 FIND FIRST SALESMAN WHERE SALESMAN.SLS# = INVOICE.SLS# NO-ERROR.
 IF NOT AVAILABLE SALESMAN THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS MANAGER DOES NOT EXIST".
     BELL.
     UNDO, RETRY.
 END.
 DISPLAY
	 INVOICE.CUST# LABEL "CUST #" SPACE(39)
	 INVOICE.ORD-NO LABEL "ORD #" SKIP(0) SPACE(41)
	 INVOICE.ITM-NO LABEL "ORD ITM" SKIP(0)
	 ACCT-RCV.C-NAME LABEL "CUST NAME" SPACE(5)
	 INVOICE.I-DATE LABEL "ORD DATE"
	 INVOICE.MONTH# LABEL "SRVC MONTH" SKIP(1)
	 INVOICE.REC-TYPE LABEL "ORD TYPE" SPACE(4)
	 INVOICE.I-DESRP LABEL "DESC" SKIP(1)
	 INVOICE.PROPSL# LABEL "PRO #" SPACE(2)
	 INVOICE.ITEM# LABEL "ITM #" SPACE(4)
	 XFREQ LABEL "FREQ" SKIP(0)
	 METPRO.L-NAME LABEL "LOCATION NAME" SKIP(0)
	 INVOICE.SLS# LABEL "MANAGER #" SPACE(3)
	 SALESMAN.SLSNAME LABEL "MANAGER'S NAME" SKIP(0)
	 INVOICE.TERM-CD LABEL "TERM CODE" SPACE(5)
	 INVOICE.TERM-DSC LABEL "TERM DESC" SKIP(0)
	 INVOICE.PO# LABEL "PURCHASE ORDER NUMBER" SKIP(0)
	 INVOICE.C-DATE LABEL "COMPLETION DATE" SPACE(5)
	 INVOICE.PRICE LABEL "DIRECT LABOR AMOUNT" SKIP(0)
	 INVOICE.TOT-INV LABEL "INVOICE AMOUNT"
	 WITH FRAME X NO-BOX SIDE-LABELS.
	 ANS = no.
	UPDATE ANS WITH ROW FRAME-ROW + 15 + FRAME-LINE + 5 COLUMN 20
		   WITH SIDE-LABELS OVERLAY FRAME DEL-FRAME NO-BOX
		   COLOR DISPLAY W/RED PROMPT RED/W.
	IF ANS THEN DO:
	    DELETE INVOICE.
	END.
  END.
