DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEF SHARED VAR XOPR AS CHAR FORMAT "XXX".
DEFINE VARIABLE D5 AS INTEGER FORMAT "9999" LABEL "YEAR (4 DIGITS)".
DEFINE VARIABLE BEG# AS INTEGER FORMAT "ZZ"
  LABEL "ENTER MONTH & YEAR FOR WHICH YOU WANT TO CREATE ORD/INV".
DEF VAR XINV AS DECIMAL FORMAT "ZZZZZZZZZZ".
    UPDATE BEG# D5 SKIP(5) WITH NO-BOX SIDE-LABELS.
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
   FOR EACH METPRO
	       WHERE METPRO.COMP# = XCOM AND
		     METPRO.DIV# = XDIV AND
		     METPRO.MTH-BILL > 0.00:
   FIND FIRST ACCT-RCV
		 WHERE ACCT-RCV.COMP# = METPRO.COMP# AND
		       ACCT-RCV.DIV# = METPRO.DIV# AND
		       ACCT-RCV.CUST# = METPRO.CUST# AND
		       ACCT-RCV.C-STATUS <> "I" NO-ERROR.
    IF NOT AVAILABLE ACCT-RCV THEN DO:
    MESSAGE "CUSTOMER(S) FOUND TO BE INACTIVE".
    NEXT.
  END.
 FIND FIRST SYSCONTROL EXCLUSIVE-LOCK.
 XINV = SYSCONTROL.NEXT-INV + 1.
 SYSCONTROL.NEXT-INV = XINV.
 RELEASE SYSCONTROL.
   CREATE INVOICE.
   UPDATE INVOICE.COMP# = METPRO.COMP#.
   UPDATE INVOICE.DIV# = METPRO.DIV#.
   UPDATE INVOICE.CUST# = METPRO.CUST#.
   UPDATE INVOICE.PROPSL# = METPRO.PROPSL#.
   UPDATE INVOICE.L-NAME = METPRO.L-NAME.
   UPDATE INVOICE.C-DATE = TODAY.
   UPDATE INVOICE.TOT-INV = METPRO.MTH-BILL.
   UPDATE INVOICE.ORD-NO = XINV.
   UPDATE INVOICE.ITEM# = 1.
   UPDATE INVOICE.MONTH# = BEG#.
   UPDATE INVOICE.ITM-NO = 1.
   UPDATE INVOICE.SLS# = 0.
   UPDATE INVOICE.INV-OPR = XOPR.
   UPDATE INVOICE.PO# = ACCT-RCV.PO#.
   UPDATE INVOICE.APPR-CD = "A".
   UPDATE INVOICE.LNE-STAT = "A".
   UPDATE INVOICE.I-TYPE = "N".
   UPDATE INVOICE.REC-TYPE = "T".
   UPDATE INVOICE.I-DESRP = "PROGRAM MONTHLY BILLING".
   UPDATE INVOICE.TERM-CD = ACCT-RCV.TERM-CD.
   FIND FIRST TERMFILE NO-ERROR.
   IF  AVAILABLE TERMFILE THEN DO:
       IF ACCT-RCV.TERM-CD = "1" THEN UPDATE INVOICE.TERM-DSC = TERM01.
       ELSE IF ACCT-RCV.TERM-CD = "2" THEN UPDATE INVOICE.TERM-DSC = TERM02.
       ELSE IF ACCT-RCV.TERM-CD = "3" THEN UPDATE INVOICE.TERM-DSC = TERM03.
       ELSE IF ACCT-RCV.TERM-CD = "4" THEN UPDATE INVOICE.TERM-DSC = TERM04.
       ELSE IF ACCT-RCV.TERM-CD = "5" THEN UPDATE INVOICE.TERM-DSC = TERM05.
       ELSE IF ACCT-RCV.TERM-CD = "6" THEN UPDATE INVOICE.TERM-DSC = TERM06.
       ELSE IF ACCT-RCV.TERM-CD = "7" THEN UPDATE INVOICE.TERM-DSC = TERM07.
       ELSE IF ACCT-RCV.TERM-CD = "8" THEN UPDATE INVOICE.TERM-DSC = TERM08.
       ELSE IF ACCT-RCV.TERM-CD = "9" THEN UPDATE INVOICE.TERM-DSC = TERM09.
       ELSE IF ACCT-RCV.TERM-CD = "10" THEN UPDATE INVOICE.TERM-DSC = TERM10.
   END.
   RELEASE INVOICE.
END.
