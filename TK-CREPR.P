DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE BEG# AS INTEGER FORMAT "ZZ"
  LABEL "ENTER MONTH & YEAR FOR WHICH YOU WANT TO RUN TICKETS".
DEFINE SHARED VARIABLE XROUTE AS INTEGER FORMAT "ZZ".
DEFINE VARIABLE H-FREQ AS CHAR FORMAT "X(5)".
DEFINE SHARED VARIABLE D2 AS DECIMAL FORMAT "9999.99".
DEFINE SHARED VARIABLE D3 AS DECIMAL FORMAT "9999".
DEFINE SHARED VARIABLE D4 AS DECIMAL FORMAT "9999.99".
DEFINE SHARED VARIABLE D5 AS INTEGER FORMAT "9999" LABEL "YEAR (4 DIGITS)".
DEFINE VARIABLE L-YEAR AS LOGICAL.
DEFINE VARIABLE TICKS AS INTEGER FORMAT "9999".
DEFINE VARIABLE F-TICK AS LOGICAL.
DEFINE VARIABLE H-WEEK AS INTEGER FORMAT "9".
DEFINE SHARED VARIABLE DY AS INTEGER FORMAT "99".
DEFINE SHARED VARIABLE UP-LIM AS INTEGER FORMAT "99".
DEFINE VARIABLE C-DATE AS DATE FORMAT "99/99/9999".
DEF VAR PRIV AS LOGICAL.
DEF VAR SECV AS LOGICAL.
DEF VAR XGRP AS CHAR FORMAT "XXX".
DEF VAR XCUST AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR XTYPE AS CHAR FORMAT "XXX".
DEF VAR X AS LOGICAL.
DEF VAR Y AS DECIMAL FORMAT ".9".
DEF VAR Z AS DECIMAL FORMAT ".9".
DEF VAR XFIRST AS LOGICAL.
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
XGRP = "".
X = yes.
XFIRST = no.
OUTPUT TO PRINTER PAGE-SIZE 0.
  FOR EACH METPRO WHERE METPRO.COMP# = XCOM AND
			METPRO.DIV# = XDIV BY METPRO.CUST#:
    IF METPRO.JANITOR THEN NEXT.
    FIND FIRST ACCT-RCV WHERE ACCT-RCV.COMP# = XCOM AND
			      ACCT-RCV.DIV# = XDIV AND
			      ACCT-RCV.CUST# = METPRO.CUST# AND
			      ACCT-RCV.C-STATUS <> "I" NO-ERROR.
    IF NOT AVAILABLE ACCT-RCV THEN NEXT.
    IF ACCT-RCV.C-STATUS = "I" THEN NEXT.
    FOR EACH METDESC /* USE-INDEX INDX2 */
				     WHERE METDESC.COMP# = XCOM AND
					   METDESC.DIV# = XDIV AND
					   METDESC.CUST# = METPRO.CUST# AND
					   METDESC.PROPSL# = METPRO.PROPSL#:
	       IF NOT XFIRST THEN DO:
		   XCUST = METDESC.CUST#.
		   XGRP = METDESC.GRP-CD.
		   XFIRST = yes.
	       END.
   XTYPE = "".
   SECV = no.
   PRIV = no.
   {TK-CRESR.I}.
   IF NOT SECV THEN DO:
       {TK-CREPR.I}.
   END.
    IF F-TICK THEN DO:
      REPEAT DY = 1 TO TICKS:
      FIND FIRST TICKET WHERE TICKET.COMP# = ACCT-RCV.COMP# AND
			      TICKET.DIV# = ACCT-RCV.DIV# AND
			      TICKET.CUST# = ACCT-RCV.CUST# AND
			      TICKET.PROPSL# = METDESC.PROPSL# AND
			      TICKET.ITEM# = METDESC.ITEM# AND
			      TICKET.MONTH# = BEG# AND
			      TICKET.T-INDX = DY NO-ERROR.
      IF AVAILABLE TICKET THEN NEXT.
    IF PRIV THEN DO:
	  IF X THEN DO:
	  Y = .5.
	  X = no.
      DISPLAY
	      SPACE(74) H-FREQ SKIP(2) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0) SPACE(20)
	      METPRO.L-NAME SPACE(1)
	      METPRO.LADDR01 SKIP(0)
	      XTYPE SPACE(17)
	      METPRO.LADDR02 SPACE(1)
	      METPRO.LADDR03 SKIP(0)
	      WITH FRAME H1 NO-BOX NO-LABELS.
	  END.
	  ELSE DO:
	   IF XGRP = METDESC.GRP-CD AND XCUST = METDESC.CUST# THEN DO:
	     Y = .5.
	     X = yes.
	     DISPLAY
	      SPACE(74) H-FREQ SKIP(0) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0)
	      WITH FRAME H2 NO-BOX NO-LABELS.
	   END.
	     ELSE DO:
	     DISPLAY SKIP(10)
	      SPACE(74) H-FREQ SKIP(2) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0) SPACE(20)
	      METPRO.L-NAME SPACE(1)
	      METPRO.LADDR01 SKIP(0)
	      XTYPE SPACE(17)
	      METPRO.LADDR02 SPACE(1)
	      METPRO.LADDR03 SKIP(0)
	     WITH FRAME H3 NO-BOX NO-LABELS.
	     X = no.
	     END.
	   END.
	   DISPLAY
	      METDESC.P-DESC1 SKIP(0)
	      METDESC.P-DESC2 SKIP(0)
	      METDESC.P-DESC3 SKIP(0)
	      METDESC.P-DESC4 SKIP(0)
	      "*"
	      METDESC.P-SPCL1 SKIP(0)
	      "*"
	      METDESC.P-SPCL2 SKIP(0)
	      WITH FRAME H4 NO-BOX NO-LABELS.
	      IF X THEN DISPLAY SKIP(2) WITH FRAME J1 NO-BOX NO-LABELS.
	      CREATE TICKET.
	      TICKET.COMP# = ACCT-RCV.COMP#.
	      TICKET.DIV# = ACCT-RCV.DIV#.
	      TICKET.CUST# = ACCT-RCV.CUST#.
	      TICKET.PROPSL# = METDESC.PROPSL#.
	      TICKET.ITEM# = METDESC.ITEM#.
	      TICKET.MONTH# = BEG#.
	      TICKET.T-INDX = DY.
	      TICKET.DATE-PRT = TODAY.
	      TICKET.DL-BUD = METDESC.P-DL.
	      TICKET.DL-BAL = METDESC.P-DL.
	      TICKET.WK-DL-BUD = METDESC.P-DL.
	      TICKET.WK-DL-BAL = METDESC.P-DL.
	      TICKET.PRT = "Y".
	      TICKET.T-STAT = "P".
	      TICKET.FREQ = METDESC.P-FREQ.
	      TICKET.TOT-AMT = METDESC.P-PPC.
	      TICKET.WK-START = METDESC.P-PPC.
	      TICKET.TOT-AMT-REM = METDESC.P-PPC.
	      TICKET.PRISEC = "P".
	      RELEASE TICKET.
	   END.
    ELSE IF SECV THEN DO:
	  IF X THEN DO:
	  Y = .5.
	  X = no.
      DISPLAY
	      SPACE(74) H-FREQ SKIP(2) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0) SPACE(20)
	      METPRO.L-NAME SPACE(1)
	      METPRO.LADDR01 SKIP(0)
	      XTYPE SPACE(17)
	      METPRO.LADDR02 SPACE(1)
	      METPRO.LADDR03 SKIP(0)
	      WITH FRAME H5 NO-BOX NO-LABELS.
	  END.
	  ELSE DO:
	   IF XGRP = METDESC.GRP-CD AND XCUST = METDESC.CUST# THEN DO:
	     Y = .5.
	     X = yes.
	     DISPLAY
	      SPACE(74) H-FREQ SKIP(0) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0)
	      WITH FRAME H6 NO-BOX NO-LABELS.
	   END.
	     ELSE DO:
	     DISPLAY SKIP(10)
	      SPACE(74) H-FREQ SKIP(2) SPACE(44)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
	      FORMAT "X(35)" SKIP(0) SPACE (20)
	      METPRO.L-NAME SPACE(1)
	      METPRO.LADDR01 SKIP(0)
	      XTYPE SPACE(17)
	      METPRO.LADDR02 SPACE(1)
	      METPRO.LADDR03 SKIP(0)
	     WITH FRAME H7 NO-BOX NO-LABELS.
	     X = no.
	     END.
	   END.
      DISPLAY
	      METDESC.S-DESC1 SKIP(0)
	      METDESC.S-DESC2 SKIP(0)
	      METDESC.S-DESC3 SKIP(0)
	      METDESC.S-DESC4 SKIP(0)
	      "*"
	      METDESC.S-SPCL1 SKIP(0)
	      "*"
	      METDESC.S-SPCL2 SKIP(0)
	      WITH FRAME H8 NO-BOX NO-LABELS.
	      IF X THEN DISPLAY SKIP(2) WITH FRAME J2 NO-BOX NO-LABELS.
	      CREATE TICKET.
	      TICKET.COMP# = ACCT-RCV.COMP#.
	      TICKET.DIV# = ACCT-RCV.DIV#.
	      TICKET.CUST# = ACCT-RCV.CUST#.
	      TICKET.PROPSL# = METDESC.PROPSL#.
	      TICKET.ITEM# = METDESC.ITEM#.
	      TICKET.MONTH# = BEG#.
	      TICKET.T-INDX = DY.
	      TICKET.DATE-PRT = TODAY.
	      TICKET.DL-BUD = METDESC.S-DL.
	      TICKET.DL-BAL = METDESC.S-DL.
	      TICKET.WK-DL-BUD = METDESC.S-DL.
	      TICKET.WK-DL-BAL = METDESC.S-DL.
	      TICKET.PRT = "Y".
	      TICKET.T-STAT = "P".
	      TICKET.FREQ = METDESC.S-FREQ.
	      TICKET.TOT-AMT = METDESC.S-PPC.
	      TICKET.WK-START = METDESC.S-PPC.
	      TICKET.TOT-AMT-REM = METDESC.S-PPC.
	      TICKET.PRISEC = "S".
	      RELEASE TICKET.
	   END.
	       XGRP = METDESC.GRP-CD.
	       XCUST = METDESC.CUST#.
	  END.
	END.
    END.
  END.
