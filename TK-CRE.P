/*************************************************/
/* tk-cre.p                                      */
/*                                               */
/* Print monthly tickets                         */
/*                                               */
/*  02/01/2018   TO    Added laser print option  */
/*                                               */
/*************************************************/

DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XPROG AS LOGICAL.
DEFINE NEW SHARED VARIABLE BEG# AS INTEGER FORMAT "ZZ"
  LABEL "ENTER MONTH & YEAR FOR WHICH YOU WANT TO RUN TICKETS".
DEFINE NEW SHARED VARIABLE XROUTE AS INTEGER FORMAT "ZZ"
  LABEL "ENTER ROUTE NUMBER FOR THIS COMPANY AND DIVISION".
DEF NEW SHARED VAR XSUB AS INT FORMAT "ZZ"
  LABEL "ENTER SUB NUMBER FOR THIS COMPANY AND DIVISION".
DEF VAR JAN AS LOGICAL LABEL "PROCESS JANITORIAL TICKETS ?".


DEFINE VARIABLE H-FREQ AS CHAR FORMAT "X(10)".
DEFINE NEW SHARED VARIABLE D2 AS DECIMAL FORMAT "9999.99".
DEFINE NEW SHARED VARIABLE D3 AS DECIMAL FORMAT "9999".
DEFINE NEW SHARED VARIABLE D4 AS DECIMAL FORMAT "9999.99".
DEFINE NEW SHARED VARIABLE D5 AS INTEGER FORMAT "9999" LABEL "YEAR (4 DIGITS)".
DEFINE VARIABLE L-YEAR AS LOGICAL.
DEFINE VARIABLE TICKS AS INTEGER FORMAT "9999".
DEFINE VARIABLE F-TICK AS LOGICAL.
DEFINE VARIABLE H-WEEK AS INTEGER FORMAT "9".
DEFINE NEW SHARED VARIABLE DY AS INTEGER FORMAT "99".
DEFINE NEW SHARED VARIABLE UP-LIM AS INTEGER FORMAT "99".
DEFINE VARIABLE C-DATE AS DATE FORMAT "99/99/9999".

DEF NEW SHARED VAR LaserPrinter AS LOG INIT No.
DEF NEW SHARED VAR NumTickets AS INT INIT 2.

IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
OUTPUT TO TERMINAL.
DISPLAY SPACE(11)
"M O N T H L Y   T I C K E T   R E Q U E S T   S C R E E N (tk-cre.p)"
    SKIP(1) SPACE(20)
XCOM-N LABEL "COMPANY" SKIP(0) SPACE(20) XDIV-N LABEL "DIVISION"
SKIP(5) WITH FRAME A NO-BOX SIDE-LABELS.
REPEAT:
UPDATE BEG# D5 SKIP(1) XROUTE SKIP(1) XSUB SKIP(1) JAN SKIP(1)
   LaserPrinter LABEL "Send to Laser?" SKIP(1)
   /*NumTickets LABEL "Number of tickets each?"*/
   WITH NO-BOX SIDE-LABELS.

IF BEG# = 2 THEN DO:
    D2 = D5 / 4.
    D3 = TRUNCATE(D2, 0).
    D4 = D3.
    IF D4 = D2 THEN L-YEAR = yes.
END.
IF BEG# = 1 THEN UP-LIM = 31.
IF BEG# = 2 AND L-YEAR THEN UP-LIM = 29.
IF BEG# = 2 AND NOT L-YEAR THEN UP-LIM = 28.
IF BEG# = 3 THEN UP-LIM = 31.
IF BEG# = 4 THEN UP-LIM = 30.
IF BEG# = 5 THEN UP-LIM = 31.
IF BEG# = 6 THEN UP-LIM = 30.
IF BEG# = 7 THEN UP-LIM = 31.
IF BEG# = 8 THEN UP-LIM = 31.
IF BEG# = 9 THEN UP-LIM = 30.
IF BEG# = 10 THEN UP-LIM = 31.
IF BEG# = 11 THEN UP-LIM = 30.
IF BEG# = 12 THEN UP-LIM = 31.
IF BEG# > 0 AND BEG# < 13 THEN LEAVE.
END.

HIDE.
IF LASTKEY = KEYCODE("F4") THEN LEAVE.
IF LASTKEY = KEYCODE("ESC") THEN LEAVE.
    IF JAN AND NOT XPROG THEN RUN TK-CREJ.P.
    IF NOT JAN AND NOT XPROG THEN RUN TK-CRER.P.
    IF JAN AND XPROG THEN RUN TK-CREPJ.P.
    IF NOT JAN AND XPROG THEN RUN TK-CREPR.P.
