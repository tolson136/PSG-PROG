DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XOPR AS CHAR FORMAT "XXX".
DEFINE VARIABLE XCUST AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR XPROP AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR XINV AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR XITEM AS INTEGER FORMAT "ZZZZ".
DEF VAR XFREQ AS CHAR FORMAT "X(25)".
DEF VAR SALZ AS CHAR FORMAT "X(25)".
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
REPEAT:
DISPLAY SPACE(24)
"I N V O I C E   S C R E E N         (CHG)"
SKIP(1)
    XCOM-N LABEL "CMP" SPACE(1)
    XDIV-N LABEL "DIV" SPACE(1)
    XOPR LABEL "OPR" SKIP(1) WITH FRAME X.
   PROMPT-FOR INVOICE.CUST# SPACE(3) INVOICE.ORD-NO SPACE(3) INVOICE.ITM-NO
	      WITH FRAME X COLOR DISPLAY NORMAL PROMPT W/MA.
   IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETURN.
   XINV = INPUT INVOICE.ORD-NO.
   XCUST = INPUT INVOICE.CUST#.
   XITEM = INPUT INVOICE.ITM-NO.
   FIND FIRST INVOICE WHERE INVOICE.COMP# = XCOM AND
			    INVOICE.DIV# = XDIV AND
			    INVOICE.CUST# = XCUST AND
			    INVOICE.ORD-NO = XINV AND
			    INVOICE.ITM-NO = XITEM NO-ERROR.
   IF NOT AVAILABLE INVOICE THEN DO:
       BELL.
       HIDE MESSAGE.
       MESSAGE COLOR BLINK
       "ORDER #" XINV "ITM #" XITEM "NOT CREATED FOR CUST #" XCUST.
       BELL.
       UNDO, RETRY.
   END.
 FIND FIRST ACCT-RCV WHERE ACCT-RCV.COMP# = XCOM AND ACCT-RCV.DIV# = XDIV AND
			   ACCT-RCV.CUST# = INVOICE.CUST# AND
			   ACCT-RCV.C-STATUS <> "I" NO-ERROR.
 IF NOT AVAILABLE ACCT-RCV THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS CUSTOMER DOES NOT EXIST OR IS INACTIVE".
     BELL.
     UNDO, RETRY.
 END.
 XFREQ = "".
 IF INVOICE.REC-TYPE = "R" THEN DO:
     FIND FIRST METDESC WHERE METDESC.COMP# = XCOM AND
			      METDESC.DIV# = XDIV AND
			      METDESC.CUST# = INVOICE.CUST# AND
			      METDESC.PROPSL# = INVOICE.PROPSL# AND
			      METDESC.ITEM# = INVOICE.ITEM# NO-ERROR.
     IF NOT AVAILABLE METDESC THEN DO:
	 HIDE MESSAGE.
	 BELL.
	 MESSAGE COLOR BLINK
	     "THIS ITEM # DOES NOT EXIST FOR PROPOSAL " INVOICE.PROPSL#.
     END.
 END.
 FIND FIRST METPRO WHERE METPRO.COMP# = XCOM AND METPRO.DIV# = XDIV AND
			 METPRO.CUST# = INVOICE.CUST# AND
			 METPRO.PROPSL# = INVOICE.PROPSL# NO-ERROR.
 IF NOT AVAILABLE METPRO THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS PROPOSAL DOES NOT EXIST".
     BELL.
     UNDO, RETRY.
 END.
 SALZ = "".
 FIND FIRST SALESMAN WHERE SALESMAN.SLS# = INVOICE.SLS# NO-ERROR.
 IF NOT AVAILABLE SALESMAN THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS MANAGER DOES NOT EXIST".
     BELL.
 END.
 DISPLAY
	 INVOICE.CUST# LABEL "CUST #" SPACE(39)
	 INVOICE.ORD-NO LABEL "ORD #" SKIP(0) SPACE(41)
	 INVOICE.ITM-NO LABEL "ORD ITM" SKIP(0)
	 ACCT-RCV.C-NAME LABEL "CUST NAME" SPACE(5)
	 INVOICE.I-DATE LABEL "ORD DATE"
	 INVOICE.MONTH# LABEL "SRVC MONTH" SKIP(1)
	 INVOICE.REC-TYPE LABEL "ORD TYPE" SPACE(4)
	 INVOICE.I-DESRP LABEL "DESC" SKIP(1)
	 INVOICE.PROPSL# LABEL "PRO #" SPACE(2)
	 INVOICE.ITEM# LABEL "ITM #" SPACE(4)
	 XFREQ LABEL "FREQ" SKIP(0)
	 METPRO.L-NAME LABEL "LOCATION NAME" SKIP(0)
	 INVOICE.SLS# LABEL "MANAGER #" SPACE(3)
	 WITH FRAME X NO-BOX SIDE-LABELS.
	 IF SALZ <> "" THEN DO:
 DISPLAY SALESMAN.SLSNAME LABEL "MANAGER'S NAME" SKIP(0)
	 WITH FRAME X NO-BOX SIDE-LABELS.
	 END.
 DISPLAY INVOICE.TERM-CD LABEL "TERM CODE" SPACE(5)
	 INVOICE.TERM-DSC LABEL "TERM DESC" SKIP(0)
	 INVOICE.PO# LABEL "PURCHASE ORDER NUMBER" SKIP(0)
	 INVOICE.C-DATE LABEL "COMPLETION DATE" SPACE(5)
	 INVOICE.PRICE LABEL "DIRECT LABOR AMOUNT" SKIP(0)
	 INVOICE.TOT-INV LABEL "INVOICE AMOUNT"
	 WITH FRAME X NO-BOX SIDE-LABELS.
 UPDATE INVOICE.I-DATE INVOICE.MONTH# WITH FRAME X.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
REPEAT:
 UPDATE INVOICE.REC-TYPE WITH FRAME X.
 IF INVOICE.REC-TYPE = "R" THEN DO:
     XFREQ = "".
     UPDATE INVOICE.I-DESRP = "REGULAR SINGLE INVOICE CREATED".
     DISPLAY INVOICE.I-DESRP WITH FRAME X.
     LEAVE.
 END.
 ELSE
     IF INVOICE.REC-TYPE = "P" THEN DO:
	 UPDATE INVOICE.I-DESRP = "PRE-PAID SINGLE INVOICE CREATED".
	 DISPLAY INVOICE.I-DESRP WITH FRAME X.
	 LEAVE.
     END.
     ELSE IF INVOICE.REC-TYPE = "T" THEN LEAVE.
     ELSE DO:
	 HIDE MESSAGE.
	 BELL.
	 MESSAGE COLOR BLINK "INVALID INVOICE TYPE".
	 BELL.
     END.
END.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
REPEAT:
 UPDATE INVOICE.PROPSL# WITH FRAME X.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
 FIND FIRST METPRO WHERE METPRO.COMP# = XCOM AND METPRO.DIV# = XDIV AND
			 METPRO.CUST# = INVOICE.CUST# AND
			 METPRO.PROPSL# = INVOICE.PROPSL# NO-ERROR.
 IF NOT AVAILABLE METPRO THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS PROPOSAL DOES NOT EXIST".
     BELL.
     UNDO, RETRY.
 END.
 ELSE LEAVE.
 END.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
 DISPLAY INVOICE.PROPSL# WITH FRAME X.
 IF INVOICE.REC-TYPE = "R" THEN DO:
 REPEAT:
  UPDATE INVOICE.ITEM# WITH FRAME X.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
     FIND FIRST METDESC WHERE METDESC.COMP# = XCOM AND
			      METDESC.DIV# = XDIV AND
			      METDESC.CUST# = INVOICE.CUST# AND
			      METDESC.PROPSL# = INVOICE.PROPSL# AND
			      METDESC.ITEM# = INVOICE.ITEM# NO-ERROR.
     IF NOT AVAILABLE METDESC THEN DO:
	 HIDE MESSAGE.
	 BELL.
	 MESSAGE COLOR BLINK
	     "THIS ITEM # DOES NOT EXIST FOR PROPOSAL " INVOICE.PROPSL#.
     END.
     ELSE DO:
     LEAVE.
     END.
END.
END.
 IF INVOICE.REC-TYPE <> "P" THEN
 DISPLAY INVOICE.ITEM# XFREQ WITH FRAME X.
 DISPLAY METPRO.L-NAME WITH FRAME X.
 REPEAT:
 UPDATE INVOICE.SLS# WITH FRAME X.
 FIND FIRST SALESMAN WHERE SALESMAN.SLS# = INVOICE.SLS# NO-ERROR.
 IF NOT AVAILABLE SALESMAN THEN DO:
     BELL.
     HIDE MESSAGE.
     MESSAGE COLOR BLINK "THIS MANAGER DOES NOT EXIST".
     BELL.
     UNDO, RETRY.
 END.
 ELSE LEAVE.
 END.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
 DISPLAY INVOICE.SLS# SALESMAN.SLSNAME WITH FRAME X.
 UPDATE INVOICE.TERM-CD WITH FRAME X.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
   FIND FIRST TERMFILE NO-ERROR.
   IF NOT AVAILABLE TERMFILE THEN DO:
       HIDE MESSAGE.
       MESSAGE "TERM FILE HAS NOT BEEN CREATED".
   END.
   ELSE DO:
       IF INVOICE.TERM-CD = "1" THEN UPDATE INVOICE.TERM-DSC = TERM01.
       ELSE IF INVOICE.TERM-CD = "2" THEN UPDATE INVOICE.TERM-DSC = TERM02.
       ELSE IF INVOICE.TERM-CD = "3" THEN UPDATE INVOICE.TERM-DSC = TERM03.
       ELSE IF INVOICE.TERM-CD = "4" THEN UPDATE INVOICE.TERM-DSC = TERM04.
       ELSE IF INVOICE.TERM-CD = "5" THEN UPDATE INVOICE.TERM-DSC = TERM05.
       ELSE IF INVOICE.TERM-CD = "6" THEN UPDATE INVOICE.TERM-DSC = TERM06.
       ELSE IF INVOICE.TERM-CD = "7" THEN UPDATE INVOICE.TERM-DSC = TERM07.
       ELSE IF INVOICE.TERM-CD = "8" THEN UPDATE INVOICE.TERM-DSC = TERM08.
       ELSE IF INVOICE.TERM-CD = "9" THEN UPDATE INVOICE.TERM-DSC = TERM09.
       ELSE IF INVOICE.TERM-CD = "10" THEN UPDATE INVOICE.TERM-DSC = TERM10.
   END.
 DISPLAY
	 INVOICE.TERM-CD
	 INVOICE.TERM-DSC
	 WITH FRAME X.
 UPDATE INVOICE.PO# INVOICE.C-DATE INVOICE.PRICE INVOICE.TOT-INV WITH FRAME X.
   RELEASE INVOICE.
    IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN UNDO, RETRY.
  END.
