DEFINE SHARED VAR XOPR AS CHAR FORMAT "XXX".
DEFINE SHARED VAR XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VAR XDIV AS INTEGER FORMAT "ZZ".
DEFINE VAR SRV AS LOGICAL LABEL "CALCULATE SERVICE CHARGES ?".
DEFINE VAR SDATE AS DATE FORMAT "99/99/9999".
DEFINE VAR BEG# AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR END# AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR TOT-CT AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR TOT-30 AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR TOT-60 AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR TOT-90 AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR TOT-BL AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR TOT-SRV AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR ACT-SRV AS DECIMAL FORMAT "->,>>>,>>>.99".
DEFINE VAR P-PERIOD AS CHAR FORMAT "XXXXXX".
DEFINE VAR MN AS CHAR FORMAT "XX".
DEFINE VAR YR AS CHAR FORMAT "XXXX".
DEFINE VAR MNN AS INTEGER FORMAT "99".
DEFINE VAR YRN AS INTEGER FORMAT "9999".
DEFINE VAR CTR AS INTEGER FORMAT "99".
DEFINE VAR DESCR AS CHAR FORMAT "X(25)".
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
DISPLAY SPACE(18) "S T A T E M E N T   P R I N T   S C R E E N" SKIP(0)
    "COMPANY: " XCOM SPACE(29) "DIVISION: " XDIV SKIP(4)
    WITH NO-BOX NO-LABELS.
UPDATE SDATE LABEL "ENTER STATEMENT DATE" WITH NO-BOX SIDE-LABELS.
IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN LEAVE.
UPDATE SKIP(2) BEG# LABEL "ENTER BEGINNING CUSTOMER NUMBER"
    WITH NO-BOX SIDE-LABELS.
IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN LEAVE.
UPDATE SKIP(2) END# LABEL "ENTER ENDING CUSTOMER NUMBER"
    WITH NO-BOX SIDE-LABELS.
IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN LEAVE.
UPDATE SKIP(2) SRV LABEL "CALCULATE SERVICE CHARGES ?"
    WITH NO-BOX SIDE-LABELS.
IF LASTKEY = KEYCODE("F4") OR LASTKEY = KEYCODE("ESC") THEN LEAVE.
IF SRV THEN DO:
    UPDATE MNN = MONTH(SDATE).
    UPDATE YRN = YEAR(SDATE).
    MN = STRING(MNN,"99").
    YR = STRING(YRN,"9999").
    UPDATE P-PERIOD = STRING(MN + YR,"XXXXXX").
    FOR EACH ACCT-RCV WHERE ACCT-RCV.COMP# = XCOM AND
			    ACCT-RCV.DIV# = XDIV AND
			    ACCT-RCV.CUST# >= BEG# AND
			    ACCT-RCV.CUST <= END# AND
			    ACCT-RCV.C-STATUS <> "I" AND
			    ACCT-RCV.SRVC-CHG = "Y":
    TOT-SRV = 0.0.
    ACT-SRV = 0.0.
    FOR EACH TRANFILE OF ACCT-RCV WHERE TRANFILE.TR-STAT = "A" AND
				       (TRANFILE.T-TYPE = "A" OR
					TRANFILE.T-TYPE = "D" OR
					TRANFILE.T-TYPE = "N"):
    IF (SDATE - TRANFILE.T-DATE) <= 30 THEN NEXT.
    TOT-SRV = TOT-SRV + TRANFILE.T-AMT.
    END.
    IF TOT-SRV > 0.0 THEN DO:
	ACT-SRV = TOT-SRV * (SRVC-PER / 100.00).
	CREATE TRANFILE.
	SET TRANFILE.AGE = "1".
	SET TRANFILE.CHECK# = "".
	SET TRANFILE.COMMIS = 0.0.
	SET TRANFILE.COMP# = ACCT-RCV.COMP#.
	SET TRANFILE.DIV# = ACCT-RCV.DIV#.
	SET TRANFILE.CUST# = ACCT-RCV.CUST#.
	SET TRANFILE.INV-NO = 999999999.
	SET TRANFILE.PERIOD = P-PERIOD.
	SET TRANFILE.REC# = 0.
	SET TRANFILE.REFER = "SERVICE CHARGE".
	SET TRANFILE.SLS# = ACCT-RCV.SLS#.
	SET TRANFILE.SUB-CON = 0.0.
	SET TRANFILE.T-AMT = ACT-SRV.
	SET TRANFILE.T-DATE = SDATE.
	SET TRANFILE.T-OPR = XOPR.
	SET TRANFILE.T-TYPE = "D".
	SET TRANFILE.TR-STAT = "A".
	RELEASE TRANFILE.
	ACCT-RCV.SRVC-YTD = ACCT-RCV.SRVC-YTD + ACT-SRV.
	ACCT-RCV.SRVC-DUE = ACCT-RCV.SRVC-DUE + ACT-SRV.
    END.
  END.
END.
OUTPUT TO PRINTER PAGE-SIZE 0.
FOR EACH TRANFILE WHERE TRANFILE.COMP# = XCOM AND
			TRANFILE.DIV# = XDIV AND
		       (TRANFILE.T-TYPE = "A" OR
			TRANFILE.T-TYPE = "D" OR
			TRANFILE.T-TYPE = "N") AND
			TRANFILE.TR-STAT = "A" AND
			TRANFILE.CUST# >= BEG# AND
			TRANFILE.CUST# <= END#
			BREAK BY TRANFILE.CUST#:
FIND FIRST ACCT-RCV WHERE ACCT-RCV.COMP# = TRANFILE.COMP# AND
			  ACCT-RCV.DIV# = TRANFILE.DIV# AND
			  ACCT-RCV.CUST# = TRANFILE.CUST#.
IF FIRST-OF(TRANFILE.CUST#) THEN DO:
    TOT-CT = 0.0.
    TOT-30 = 0.0.
    TOT-60 = 0.0.
    TOT-90 = 0.0.
    TOT-BL = 0.0.
    CTR = 0.
    DISPLAY SKIP(13) ACCT-RCV.C-NAME SPACE(22) SDATE SPACE(4) ACCT-RCV.CUST#
	WITH FRAME A NO-BOX NO-LABELS.
    IF ACCT-RCV.ADDR-5 <> "" THEN DO:
	DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 SKIP(0)
		ACCT-RCV.ADDR-4 SKIP(0) ACCT-RCV.ADDR-5 + ", " +
		ACCT-RCV.STATE + " " + ACCT-RCV.ZIP FORMAT "X(40)" SKIP(7)
		WITH FRAME B NO-BOX NO-LABELS.
	END.
    ELSE
	IF ACCT-RCV.ADDR-4 <> "" THEN DO:
	    DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 SKIP(0)
		    ACCT-RCV.ADDR-4 + ", " + ACCT-RCV.STATE + " " +
		    ACCT-RCV.ZIP FORMAT "X(40)" SKIP(8)
		    WITH FRAME C NO-BOX NO-LABELS.
	    END.
	ELSE
	    IF ACCT-RCV.ADDR-3 <> "" THEN DO:
		DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 + ", " +
			ACCT-RCV.STATE + " " + ACCT-RCV.ZIP FORMAT "X(40)"
			SKIP(9) WITH FRAME D NO-BOX NO-LABELS.
		 END.
	ELSE
	    DISPLAY SKIP(11) WITH FRAME W NO-BOX NO-LABELS.
END.
IF CTR > 12 THEN DO:
    CTR = 0.
    DISPLAY SKIP(6) SPACE(49) "CONTINUED ON NEXT PAGE" SKIP(16) ACCT-RCV.C-NAME
    SPACE(22) SDATE SPACE(4) ACCT-RCV.CUST# WITH FRAME E NO-BOX NO-LABELS.
    IF ACCT-RCV.ADDR-5 <> "" THEN DO:
	DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 SKIP(0)
		ACCT-RCV.ADDR-4 SKIP(0) ACCT-RCV.ADDR-5 + ", " +
		ACCT-RCV.STATE + " " + ACCT-RCV.ZIP FORMAT "X(40)" SKIP(7)
		WITH FRAME F NO-BOX NO-LABELS.
	END.
    ELSE
	IF ACCT-RCV.ADDR-4 <> "" THEN DO:
	    DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 SKIP(0)
		    ACCT-RCV.ADDR-4 + ", " + ACCT-RCV.STATE + " " +
		    ACCT-RCV.ZIP FORMAT "X(40)" SKIP(8)
		    WITH FRAME G NO-BOX NO-LABELS.
	    END.
	ELSE
	    IF ACCT-RCV.ADDR-3 <> "" THEN DO:
		DISPLAY ACCT-RCV.ADDR-2 SKIP(0) ACCT-RCV.ADDR-3 + ", " +
			ACCT-RCV.STATE + " " + ACCT-RCV.ZIP FORMAT "X(40)"
			SKIP(9) WITH FRAME H NO-BOX NO-LABELS.
		 END.
	ELSE
	    DISPLAY SKIP(11) WITH FRAME X NO-BOX NO-LABELS.
END.
    DESCR = "".
    FIND FIRST INVOICE WHERE INVOICE.COMP# = XCOM AND
			     INVOICE.DIV# = XDIV AND
			     INVOICE.CUST# = TRANFILE.CUST# AND
			     INVOICE.INV-NO = TRANFILE.INV-NO NO-ERROR.
    IF AVAILABLE INVOICE THEN DESCR = INVOICE.L-NAME.
    IF NOT AVAILABLE INVOICE THEN DESCR = "".
    IF TRANFILE.T-TYPE = "N"
	THEN DESCR = "       FUEL SURCHG       ".
    IF TRANFILE.T-TYPE = "D"
	THEN DESCR = "        SRVC CHRG        ".
    DISPLAY TRANFILE.T-DATE TRANFILE.INV-NO DESCR
	    TRANFILE.T-AMT FORMAT "->,>>>,>>>.99" WITH FRAME I NO-BOX NO-LABELS.
    IF (SDATE - TRANFILE.T-DATE) > 90 THEN TOT-90 = TOT-90 + TRANFILE.T-AMT.
    IF (SDATE - TRANFILE.T-DATE) > 60 AND (SDATE - TRANFILE.T-DATE) <= 90
	THEN TOT-60 = TOT-60 + TRANFILE.T-AMT.
    IF (SDATE - TRANFILE.T-DATE) > 30 AND (SDATE - TRANFILE.T-DATE) <= 60
	THEN TOT-30 = TOT-30 + TRANFILE.T-AMT.
    IF (SDATE - TRANFILE.T-DATE) <= 30 THEN TOT-CT = TOT-CT + TRANFILE.T-AMT.
    TOT-BL = TOT-BL + TRANFILE.T-AMT.
    CTR = CTR + 1.
    IF LAST-OF(TRANFILE.CUST#) THEN DO:
	IF CTR = 1 THEN DO:
	    DISPLAY SKIP(16) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME J NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 2 THEN DO:
	    DISPLAY SKIP(15) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME K NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 3 THEN DO:
	    DISPLAY SKIP(14) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME L NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 4 THEN DO:
	    DISPLAY SKIP(13) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME M NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 5 THEN DO:
	    DISPLAY SKIP(12) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME N NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 6 THEN DO:
	    DISPLAY SKIP(11) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME O NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 7 THEN DO:
	    DISPLAY SKIP(10) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME P NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 8 THEN DO:
	    DISPLAY SKIP(9) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME Q NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 9 THEN DO:
	    DISPLAY SKIP(8) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME R NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 10 THEN DO:
	    DISPLAY SKIP(7) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME S NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 11 THEN DO:
	    DISPLAY SKIP(6) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME T NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 12 THEN DO:
	    DISPLAY SKIP(5) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME U NO-BOX NO-LABELS.
	    END.
	ELSE
	IF CTR = 13 THEN DO:
	    DISPLAY SKIP(4) TOT-CT SPACE(2) TOT-30 SPACE(2) TOT-60 SPACE(2)
	    TOT-90 SPACE(2) TOT-BL SKIP(5) WITH FRAME V NO-BOX NO-LABELS.
	    END.
	END.
END.
