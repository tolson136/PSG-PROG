DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XOPR AS CHAR FORMAT "XXX".
DEFINE VARIABLE XCUST AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR XPROP AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEF VAR Q1 AS CHAR FORMAT "X(25)".
DEF VAR Q2 AS CHAR FORMAT "X(25)".
DEF VAR Q3 AS CHAR FORMAT "X(25)".
DEF VAR QNAME AS CHAR FORMAT "X(25)".
DEF VAR QSTATE AS CHAR FORMAT "XX".
DEF VAR QMENTS AS CHAR FORMAT "X(10)".
DEF VAR QTELE AS CHAR FORMAT "(999) 999-9999".
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
REPEAT:
DISPLAY SPACE(13)
"A C C O U N T   M A I N T E N A N C E   S C R E E N         (ADD)"
SKIP(0)
    XCOM-N LABEL "CMP" SPACE(1)
    XDIV-N LABEL "DIV" SPACE(1)
    XOPR LABEL "OPR" SKIP(0).
    DO TRANSACTION:
    FIND FIRST SYSCONTROL SHARE-LOCK.
    XCUST = SYSCONTROL.NEXT-CST + 1.
    SYSCONTROL.NEXT-CST = XCUST.
    END.
    DO TRANSACTION:
    FIND FIRST ACCT-RCV WHERE ACCT-RCV.CUST# = XCUST AND ACCT-RCV.COMP# = XCOM
    AND ACCT-RCV.DIV# = XDIV NO-ERROR.
    IF AVAILABLE ACCT-RCV
    THEN DO:
       MESSAGE "CUSTOMER # "
         XCUST
         " ALREADY EXISTS. PLEASE TRY ANOTHER".
       UNDO, RETRY.
    END.
    CREATE ACCT-RCV.
    UPDATE ACCT-RCV.COMP# = XCOM.
    UPDATE ACCT-RCV.DIV# = XDIV.
    UPDATE ACCT-RCV.CUST# = XCUST.
    DISPLAY ACCT-RCV.CUST# LABEL "CUSTOMER NUMBER" SPACE(3)
        WITH SIDE-LABELS NO-BOX.
        FIND FIRST METPRO WHERE METPRO.COMP# = XCOM AND METPRO.DIV# = XDIV AND
                      METPRO.CUST# = XCUST NO-ERROR.
        IF NOT AVAILABLE METPRO THEN DO:
        MESSAGE
        "NO PROPOSAL HAS BEEN CREATED FOR THIS CUSTOMER".
            ASSIGN XPROP = 0.
            ASSIGN Q1 = "".
            ASSIGN Q2 = "".
            ASSIGN Q3 = "".
            ASSIGN QNAME = "".
            ASSIGN QSTATE = "".
            ASSIGN QMENTS = "".
            ASSIGN QTELE = "".
        END.
        ELSE DO:
            ASSIGN XPROP = METPRO.PROPSL#.
            ASSIGN Q1 = METPRO.LADDR01.
            ASSIGN Q2 = METPRO.LADDR02.
            ASSIGN Q3 = METPRO.LADDR03.
            ASSIGN QNAME = METPRO.L-NAME.
            ASSIGN QSTATE = METPRO.L-STATE.
            ASSIGN QMENTS = METPRO.L-COMMENTS.
            ASSIGN QTELE = METPRO.L-TELE.
            MESSAGE "PROPOSAL # " XPROP " EXISTS FOR THIS CUSTOMER".
        END.
    DISPLAY XPROP LABEL "CURRENT PROPOSAL #"
            ACCT-RCV.COMP# LABEL "COMPANY NUMBER " SKIP(0)
            ACCT-RCV.C-NAME LABEL "CUSTOMER NAME  " SPACE(4)
            C-STATUS LABEL "STATUS" SPACE(6)
            ACCT-RCV.DIV# LABEL "DIVISION NUMBER" SKIP(0)
            ADDR-1 LABEL "ADDRESS 1" SPACE(5)
            QNAME LABEL "LOC NAME.." SKIP(0)
            ADDR-2 LABEL "ADDRESS 2" SPACE(5)
            Q1 LABEL "LOC ADDR 1" SKIP(0)
            ADDR-3 LABEL "ADDRESS 3" SPACE(5)
            Q2 LABEL "LOC ADDR 2" SKIP(0)
            ADDR-4 LABEL "ADDRESS 4" SPACE(5)
            Q3 LABEL "LOC ADDR 3" SKIP(0)
            ADDR-5 LABEL "ADDRESS 5" SPACE(5)
            QSTATE LABEL "LOC STATE " SPACE(2)
            QMENTS LABEL "LOC COMM." SKIP(0)
            ACCT-RCV.STATE LABEL "STATE    " SPACE(8)
            ACCT-RCV.ZIP SPACE(5)
            QTELE LABEL "LOC TELEPHONE" SKIP(0)
            ACCT-RCV.TELE LABEL "TELEPHONE"
            PO# LABEL "PO#"
            ACCT-RCV.SUB#
            ACCT-RCV.ROUTE# SKIP(0)
            EXP-DATE LABEL "CONTRACT START DATE." SPACE(9)
            ACCT-RCV.EXPIRE-DT LABEL "EXPIRATION DATE" SKIP(0)
            COMMENTS LABEL "COMMENTS " SPACE(5)
            SHRT-NAM LABEL "SHORT NAME" SPACE(2)
            C-TYPE LABEL "CUSTOMER TYPE......." SKIP(0)
            OPEN-DT LABEL "OPEN DATE" SPACE(5)
            STMT-CD LABEL "PRINT STATEMENT? Y/N" SPACE(6)
            SRVC-CHG LABEL "SRV?"
            SRVC-PER LABEL "%"
            SRVC-DAYS LABEL "DAYS"
            Fuel_Sur Label "Fuel?"
            Fuel% Label "Multiplier" SKIP(0)
            LP-DATE LABEL "PAY DATE." SPACE(5)
            SLS# LABEL "SALES PERSON........" SPACE(4)
            CITY-CD LABEL "CITY CODE........." SKIP(0)
            LST-DATE LABEL "SALE DATE" SPACE(5)
            TERM-CD LABEL "TERMS CODE.........." SPACE(6)
            CNTY-CD LABEL "COUNTY CODE......." SKIP(0)
            BAL-1 LABEL "PERIOD 1 BALANCE" SPACE(2)
            SLS-YTD LABEL "SALES YTD........." SKIP(0)
            BAL-2 LABEL "PERIOD 2 BALANCE" SPACE(2)
            COST-YTD LABEL "COST YTD.........." SKIP(0)
            BAL-3 LABEL "PERIOD 3 BALANCE" SPACE(2)
            SRVC-YTD LABEL "SERVICE CHARGE YTD" SKIP(0)
            BAL-4 LABEL "PERIOD 4 BALANCE" SPACE(2)
            SLS-LAST LABEL "SALES LAST YEAR..." SKIP(0)
            FUTR-DUE LABEL "FUTURE BALANCE.." SPACE(2)
            CST-LAST LABEL "COST LAST YEAR...." SKIP(0)
            SRVC-DUE LABEL "SERV CHARGE DUE." SPACE(2)
            TOT-BAL LABEL "TOTAL BALANCE DUE." SKIP(0)
               WITH SIDE-LABELS NO-BOX.
    PROMPT-FOR ACCT-RCV.C-NAME ADDR-1 ADDR-2 ADDR-3 ADDR-4 ADDR-5
               ACCT-RCV.STATE ACCT-RCV.ZIP ACCT-RCV.TELE EXP-DATE COMMENTS
               OPEN-DT LP-DATE LST-DATE PO# ACCT-RCV.EXPIRE-DT SHRT-NAM
               STMT-CD SLS#
               TERM-CD C-TYPE SRVC-CHG SRVC-PER SRVC-DAYS
               Fuel_Sur Fuel% CITY-CD CNTY-CD BAL-1 BAL-2
               BAL-3 BAL-4 FUTR-DUE SRVC-DUE SLS-YTD COST-YTD SRVC-YTD
               SLS-LAST CST-LAST TOT-BAL WITH COLOR DISPLAY NORMAL PROMPT W/MA.
    ASSIGN ACCT-RCV.
END.
END.
