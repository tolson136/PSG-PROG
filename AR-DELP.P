DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE VARIABLE XCUST AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VAR XPROP AS DECIMAL FORMAT "ZZZZZZZZZZ".
DEFINE VARIABLE ANS AS LOGICAL LABEL
       "Do you wish to delete this customer ?".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XOPR AS CHAR FORMAT "XXX".
DEF VAR Q1 AS CHAR FORMAT "X(25)".
DEF VAR Q2 AS CHAR FORMAT "X(25)".
DEF VAR Q3 AS CHAR FORMAT "X(25)".
DEF VAR QNAME AS CHAR FORMAT "(25)".
DEF VAR QSTATE AS CHAR FORMAT "XX".
DEF VAR QMENTS AS CHAR FORMAT "X(10)".
DEF VAR QTELE AS CHAR FORMAT "(999) 999-9999".
DEF VAR T1 AS LOGICAL.
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
REPEAT:
DISPLAY SPACE(13)
"A C C O U N T   M A I N T E N A N C E   S C R E E N         (DEL)"
SKIP(0)
    XCOM-N LABEL "CMP" SPACE(1)
    XDIV-N LABEL "DIV" SPACE(1)
    XOPR LABEL "OPR" SKIP(0).
    PROMPT-FOR ACCT-RCV.CUST# WITH COLOR DISPLAY NORMAL PROMPT W/MA.
    XCUST = INPUT ACCT-RCV.CUST#.
    FIND FIRST ACCT-RCV WHERE ACCT-RCV.CUST# = XCUST AND
			      ACCT-RCV.COMP# = XCOM AND
			      ACCT-RCV.DIV# = XDIV NO-ERROR.
    IF NOT AVAILABLE ACCT-RCV
	THEN DO:
	    MESSAGE "CUSTOMER # " XCUST " DOES NOT EXIST. TRY ANOTHER.".
	    UNDO, RETRY.
	END.
    T1 = no.
    FIND FIRST TICKET WHERE TICKET.COMP# = XCOM AND
			    TICKET.DIV# = XDIV AND
			    TICKET.CUST# = XCUST AND
			    (TICKET.T-STAT = "P" OR
			     TICKET.T-STAT = "I") NO-ERROR.
    IF AVAILABLE TICKET THEN DO:
	MESSAGE
	T1 = yes.
    END.
    ASSIGN XPROP = 0.
    ASSIGN Q1 = "".
    ASSIGN Q2 = "".
    ASSIGN Q3 = "".
    ASSIGN QNAME = "".
    ASSIGN QSTATE = "".
    ASSIGN QMENTS = "".
    ASSIGN QTELE = "".
    FIND FIRST METPRO WHERE METPRO.COMP# = XCOM AND
			    METPRO.DIV# = XDIV AND
			    METPRO.CUST# = XCUST NO-ERROR.
    IF AVAILABLE METPRO THEN DO:
    ASSIGN XPROP = METPRO.PROPSL#.
    ASSIGN Q1 = METPRO.LADDR01.
    ASSIGN Q2 = METPRO.LADDR02.
    ASSIGN Q3 = METPRO.LADDR03.
    ASSIGN QNAME = METPRO.L-NAME.
    ASSIGN QSTATE = METPRO.L-STATE.
    ASSIGN QMENTS = METPRO.L-COMMENTS.
    ASSIGN QTELE = METPRO.L-TELE.
    END.
    IF LASTKEY = KEYCODE("F4") THEN LEAVE.
	DISPLAY
	    ACCT-RCV.CUST# LABEL "CUSTOMER NUMBER" SPACE(3)
	    XPROP LABEL "CURRENT PROPOSAL #"
	    ACCT-RCV.COMP# LABEL "COMPANY NUMBER " SKIP(0)
	    ACCT-RCV.C-NAME LABEL "CUSTOMER NAME  " SPACE(4)
	    C-STATUS LABEL "STATUS" SPACE(6)
	    ACCT-RCV.DIV# LABEL "DIVISION NUMBER" SKIP(0)
	    ADDR-1 LABEL "ADDRESS 1" SPACE(5)
	    QNAME LABEL "LOC NAME.." SKIP(0)
	    ADDR-2 LABEL "ADDRESS 2" SPACE(5)
	    Q1 LABEL "LOC ADDR 1" SKIP(0)
	    ADDR-3 LABEL "ADDRESS 3" SPACE(5)
	    Q2 LABEL "LOC ADDR 2" SKIP(0)
	    ADDR-4 LABEL "ADDRESS 4" SPACE(5)
	    Q3 LABEL "LOC ADDR 3" SKIP(0)
	    ADDR-5 LABEL "ADDRESS 5" SPACE(5)
	    QSTATE LABEL "LOC STATE " SPACE(2)
	    QMENTS LABEL "LOC COMM." SKIP(0)
	    ACCT-RCV.STATE LABEL "STATE    " SPACE(8)
	    ACCT-RCV.ZIP SPACE(5)
	    QTELE LABEL "LOC TELEPHONE" SKIP(0)
	    ACCT-RCV.TELE LABEL "TELEPHONE" SPACE(16)
	    PO# LABEL "PO#" SKIP(0)
	    EXP-DATE LABEL "CONTRACT EXPIRATION DATE." SPACE(9)
	    ACCT-RCV.EXPIRE-DT LABEL "EXPIRATION DATE" SKIP(0)
	    COMMENTS LABEL "COMMENTS " SPACE(5)
	    SHRT-NAM LABEL "SHORT NAME" SPACE(2)
	    C-TYPE LABEL "CUSTOMER TYPE......." SKIP(0)
	    OPEN-DT LABEL "OPEN DATE" SPACE(5)
	    STMT-CD LABEL "PRINT STATEMENT? Y/N" SPACE(6)
	    SRVC-CHG LABEL "SRV?"
	    SRVC-PER LABEL "%"
	    SRVC-DAYS LABEL "DAYS" SKIP(0)
	    LP-DATE LABEL "PAY DATE." SPACE(5)
	    SLS# LABEL "SALES PERSON........" SPACE(4)
	    CITY-CD LABEL "CITY CODE........." SKIP(0)
	    LST-DATE LABEL "SALE DATE" SPACE(5)
	    TERM-CD LABEL "TERMS CODE.........." SPACE(6)
	    CNTY-CD LABEL "COUNTY CODE......." SKIP(0)
	    BAL-1 LABEL "PERIOD 1 BALANCE" SPACE(2)
	    SLS-YTD LABEL "SALES YTD........." SKIP(0)
	    BAL-2 LABEL "PERIOD 2 BALANCE" SPACE(2)
	    COST-YTD LABEL "COST YTD.........." SKIP(0)
	    BAL-3 LABEL "PERIOD 3 BALANCE" SPACE(2)
	    SRVC-YTD LABEL "SERVICE CHARGE YTD" SKIP(0)
	    BAL-4 LABEL "PERIOD 4 BALANCE" SPACE(2)
	    SLS-LAST LABEL "SALES LAST YEAR..." SKIP(0)
	    FUTR-DUE LABEL "FUTURE BALANCE.." SPACE(2)
	    CST-LAST LABEL "COST LAST YEAR...." SKIP(0)
	    SRVC-DUE LABEL "SERV CHARGE DUE." SPACE(2)
	    TOT-BAL LABEL "TOTAL BALANCE DUE."
	       WITH SIDE-LABELS NO-BOX OVERLAY.
IF T1 AND XPROP > 0.0 THEN DO:
	MESSAGE
 "THIS CUSTOMER HAS OUTSTANDING TICKETS & PROPOSALS. IT WILL NOT BE DELETED.".
 END.
IF NOT T1 AND XPROP > 0.0 THEN DO:
	MESSAGE "CUSTOMER # " XCUST " HAS PROPOSAL(S). DELETE THEM FIRST.".
END.
IF T1 AND XPROP = 0.0 THEN DO:
      MESSAGE "THIS CUSTOMER HAS OUTSTANDING TICKETS. IT WILL NOT BE DELETED.".
END.
	    IF XPROP > 0.0 OR T1 THEN DO:
		UNDO, RETRY.
	    END.
	    ELSE DO:
	    UPDATE ANS WITH ROW FRAME-ROW + 15 + FRAME-LINE + 5 COLUMN 20
		 WITH SIDE-LABELS OVERLAY FRAME DEL-FRAME NO-BOX
		 COLOR DISPLAY WHITE/RED PROMPT RED/WHITE.
	    IF ANS
	    THEN DO:
	     DELETE ACCT-RCV.
	    END.
	END.
END.
