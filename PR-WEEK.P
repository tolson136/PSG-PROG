DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE VARIABLE B-DATE AS DATE FORMAT "99/99/9999"
    LABEL "ENTER FIRST DATE OF PAYROLL PERIOD".
DEFINE VARIABLE E-DATE AS DATE FORMAT "99/99/9999"
    LABEL "ENTER LAST DATE OF PAYROLL PERIOD".
DEF VAR S-TOT-HRS AS DECIMAL FORMAT "->>>,>>>,>>>.99".
DEF VAR T-TOT-HRS AS DECIMAL FORMAT "->>>,>>>,>>>.99".
DEF VAR S-TOT-DOL AS DECIMAL FORMAT "$->>>,>>>,>>>.99".
DEF VAR T-TOT-DOL AS DECIMAL FORMAT "$->>>,>>>,>>>.99".
DEF VAR EMP-SUM AS LOGICAL LABEL "PRINT ALL EMPLOYEE SUMMARY ?".
DEF VAR BAD_DL AS LOGICAL.
IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
DISPLAY SPACE(11)
"W E E K L Y   E M P L O Y E E   R E P O R T   S C R E E N"
    SKIP(1)
XCOM-N LABEL "CO" XDIV-N LABEL "DV" SKIP(5)
    WITH FRAME X NO-BOX SIDE-LABELS.
UPDATE B-DATE SKIP(2) E-DATE SKIP(2) EMP-SUM
    WITH FRAME Y COLOR DISPLAY NORMAL PROMPT W/MA NO-BOX SIDE-LABELS.
OUTPUT TO PRINTER.
FOR EACH EMPLOYEE /* USE-INDEX INDX1 */
		  WHERE EMPLOYEE.COMP# = XCOM AND
			EMPLOYEE.DIV# = XDIV AND
			EMPLOYEE.WDATE >= B-DATE AND
			EMPLOYEE.WDATE <= E-DATE
			BREAK BY EMPLOYEE.E-NUM BY EMPLOYEE.WDATE:
FIND TICKET WHERE TICKET.COMP# =   EMPLOYEE.COMP# AND
			TICKET.DIV# =    EMPLOYEE.DIV# AND
			TICKET.CUST# =   EMPLOYEE.CUST# AND
			TICKET.PROPSL# = EMPLOYEE.PROPSL# AND
			TICKET.ITEM# =   EMPLOYEE.ITEM# AND
			TICKET.MONTH# =  EMPLOYEE.MONTH# AND
			TICKET.T-INDX =  EMPLOYEE.T-INDX no-error.
IF AVAILABLE TICKET THEN DO:
    IF TICKET.WK-DL = 0.00 THEN NEXT.
END.
ELSE DO:
    NEXT.
END.
FORM HEADER TODAY FORMAT "99/99/9999"
	    "WEEKLY EMPLOYEE REPORT" AT 29 "PAGE:" AT 65
	    PAGE-NUMBER FORMAT ">>9" SKIP(1) XCOM-N SPACE(5) XDIV-N SKIP(1)
	    "FROM:" AT 23 B-DATE "TO:" AT 43 E-DATE SKIP(1)
	    "TICKET NUMBER" AT 1 SKIP(0) "EMP#" AT 1 "EMPLOYEE NAME" AT 7
	    "WORK DATE" AT 33 "HOURS" AT 49 "DOLLARS" AT 64 SKIP(1)
	    WITH FRAME P PAGE-TOP NO-LABELS NO-BOX.
     VIEW FRAME P.
     T-TOT-HRS = T-TOT-HRS + WHOURS.
     T-TOT-DOL = T-TOT-DOL + EMPLOYEE.TOT-AMT.
     IF FIRST-OF(EMPLOYEE.E-NUM) AND LAST-OF(EMPLOYEE.E-NUM)
	 THEN DO:
	     S-TOT-HRS = 0.00.
	     S-TOT-DOL = 0.00.
	     DISPLAY
	      STRING(EMPLOYEE.COMP#, ">>") + "-" +
	      TRIM(STRING(EMPLOYEE.DIV#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.MONTH#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.T-INDX, ">>"))
		FORMAT "X(35)" SKIP(0)
		EMPLOYEE.E-NUM
		EMPLOYEE.E-NAME
		EMPLOYEE.WDATE
		EMPLOYEE.WHOURS
		EMPLOYEE.TOT-AMT SKIP(1)
		WITH FRAME Z NO-BOX NO-LABELS.
	      NEXT.
	 END.
     IF FIRST-OF(EMPLOYEE.E-NUM)
	 THEN DO:
	     S-TOT-HRS = 0.00.
	     S-TOT-DOL = 0.00.
	     DISPLAY
	      STRING(EMPLOYEE.COMP#, ">>") + "-" +
	      TRIM(STRING(EMPLOYEE.DIV#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.MONTH#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.T-INDX, ">>"))
		FORMAT "X(35)" SKIP(0)
		EMPLOYEE.E-NUM
		EMPLOYEE.E-NAME
		EMPLOYEE.WDATE
		EMPLOYEE.WHOURS
		EMPLOYEE.TOT-AMT
		WITH FRAME A NO-BOX NO-LABELS.
	    S-TOT-HRS = S-TOT-HRS + WHOURS.
	    S-TOT-DOL = S-TOT-DOL + EMPLOYEE.TOT-AMT.
	    NEXT.
       END.
       IF LAST-OF(EMPLOYEE.E-NUM)
	 THEN DO:
	    S-TOT-HRS = S-TOT-HRS + WHOURS.
	    S-TOT-DOL = S-TOT-DOL + EMPLOYEE.TOT-AMT.
	     DISPLAY
	      STRING(EMPLOYEE.COMP#, ">>") + "-" +
	      TRIM(STRING(EMPLOYEE.DIV#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.MONTH#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.T-INDX, ">>"))
		FORMAT "X(35)" SKIP(0)
		EMPLOYEE.E-NUM
		EMPLOYEE.E-NAME
		EMPLOYEE.WDATE
		EMPLOYEE.WHOURS
		EMPLOYEE.TOT-AMT SKIP(0)
		SPACE(37) S-TOT-HRS
		S-TOT-DOL SKIP(1)
		WITH FRAME B NO-BOX NO-LABELS.
	    S-TOT-HRS = 0.00.
	    S-TOT-DOL = 0.00.
	    NEXT.
	END.
    ELSE DO:
	     DISPLAY
	      STRING(EMPLOYEE.COMP#, ">>") + "-" +
	      TRIM(STRING(EMPLOYEE.DIV#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(EMPLOYEE.MONTH#, ">>")) + "-" +
	      TRIM(STRING(EMPLOYEE.T-INDX, ">>"))
		FORMAT "X(35)" SKIP(0)
		EMPLOYEE.E-NUM
		EMPLOYEE.E-NAME
		EMPLOYEE.WDATE
		EMPLOYEE.WHOURS
		EMPLOYEE.TOT-AMT
		WITH FRAME C NO-BOX NO-LABELS.
	    S-TOT-HRS = S-TOT-HRS + WHOURS.
	    S-TOT-DOL = S-TOT-DOL + EMPLOYEE.TOT-AMT.
     END.
END.
DISPLAY SKIP(2) SPACE(21) "T O T A L S" SPACE(5) T-TOT-HRS T-TOT-DOL
    WITH FRAME D NO-LABELS NO-BOX.
    OUTPUT TO TERMINAL.
IF EMP-SUM
    THEN DO:
    OUTPUT TO PRINTER.
    T-TOT-HRS = 0.0.
    T-TOT-DOL = 0.0.
FOR EACH EMPLOYEE /* USE-INDEX INDX2 */
		  WHERE EMPLOYEE.COMP# = XCOM AND
			EMPLOYEE.WDATE >= B-DATE AND
			EMPLOYEE.WDATE <= E-DATE
			BREAK BY EMPLOYEE.E-NUM:
FIND TICKET WHERE TICKET.COMP# =   EMPLOYEE.COMP# AND
			TICKET.DIV# =    EMPLOYEE.DIV# AND
			TICKET.CUST# =   EMPLOYEE.CUST# AND
			TICKET.PROPSL# = EMPLOYEE.PROPSL# AND
			TICKET.ITEM# =   EMPLOYEE.ITEM# AND
			TICKET.MONTH# =  EMPLOYEE.MONTH# AND
			TICKET.T-INDX =  EMPLOYEE.T-INDX no-error.
IF AVAILABLE TICKET THEN DO:
    IF TICKET.WK-DL = 00.0 THEN BAD_DL = yes. ELSE BAD_DL = no.
END.
ELSE DO:
    NEXT.
END.
FORM HEADER TODAY FORMAT "99/99/9999"
	    "WEEKLY EMPLOYEE REPORT (BY COMP)" AT 24 "PAGE:" AT 65
	    PAGE-NUMBER FORMAT ">>9" SKIP(1)
	    XCOM-N SKIP(1)
	    "FROM:" AT 20 B-DATE "TO:" AT 40 E-DATE SKIP(1)
	    "EMP#" AT 1 "EMPLOYEE NAME" AT 7
	    "HOURS" AT 42 "DOLLARS" AT 57 SKIP(2)
	    WITH FRAME PP PAGE-TOP NO-LABELS NO-BOX.
     VIEW FRAME PP.
     IF NOT BAD_DL THEN DO:
	T-TOT-HRS = T-TOT-HRS + WHOURS.
	T-TOT-DOL = T-TOT-DOL + EMPLOYEE.TOT-AMT.
     END.
       IF LAST-OF(EMPLOYEE.E-NUM)
	 THEN DO:
	   IF NOT BAD_DL THEN DO:
	    S-TOT-HRS = S-TOT-HRS + WHOURS.
	    S-TOT-DOL = S-TOT-DOL + EMPLOYEE.TOT-AMT.
	   END.
	    IF S-TOT-HRS > 0 OR S-TOT-DOL > 0.00 THEN DO:
	     DISPLAY
		EMPLOYEE.E-NUM
		EMPLOYEE.E-NAME
		S-TOT-HRS
		S-TOT-DOL SKIP(1)
		WITH FRAME BB NO-BOX NO-LABELS.
	     END.
	    S-TOT-HRS = 0.00.
	    S-TOT-DOL = 0.00.
	END.
    ELSE DO:
	IF NOT BAD_DL THEN DO:
	    S-TOT-HRS = S-TOT-HRS + WHOURS.
	    S-TOT-DOL = S-TOT-DOL + EMPLOYEE.TOT-AMT.
	END.
     END.
END.
DISPLAY SKIP(2) SPACE(15) "T O T A L S" SPACE(5) T-TOT-HRS T-TOT-DOL
    WITH FRAME DD NO-LABELS NO-BOX.
END.
