DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE VARIABLE BEG# AS INTEGER FORMAT "ZZ"
  LABEL "ENTER MONTH & YEAR FOR WHICH YOU WANT TO RUN TICKETS".
DEFINE VARIABLE T-PRT AS LOGICAL LABEL "SUMMARY ONLY REPORT?".
DEFINE VARIABLE H-FREQ AS CHAR FORMAT "X(10)".
DEFINE VARIABLE D2 AS DECIMAL FORMAT "9999.99".
DEFINE VARIABLE D3 AS DECIMAL FORMAT "9999".
DEFINE VARIABLE D4 AS DECIMAL FORMAT "9999.99".
DEFINE VARIABLE D5 AS INTEGER FORMAT "9999" LABEL "YEAR (4 DIGITS)".
DEFINE VARIABLE L-YEAR AS LOGICAL.
DEFINE VARIABLE TICKS AS INTEGER FORMAT "9999".
DEFINE VARIABLE F-TICK AS LOGICAL.
DEFINE VARIABLE H-WEEK AS INTEGER FORMAT "9".
DEFINE VARIABLE DY AS INTEGER FORMAT "99".
DEFINE VARIABLE UP-LIM AS INTEGER FORMAT "99".
DEFINE VARIABLE C-DATE AS DATE FORMAT "99/99/9999".
DEFINE VAR T-DL AS DECIMAL FORMAT "$->,>>>,>>>.99".
DEFINE VAR T-BILL AS DECIMAL FORMAT "$->,>>>,>>>.99".
DEFINE VAR H-MON AS CHARACTER FORMAT "X(10)".
DEF VAR EXP-CHECK AS CHARACTER FORMAT "XXX".
DEF VAR HAR-DESP AS CHARACTER FORMAT "X(60)".
DEF VAR BIRD-CRY AS LOGICAL LABEL "INCLUDE DESCRIPTIONS ON REPORT ?".
DEF VAR SECV AS LOGICAL.
DEF VAR PRIV AS LOGICAL.
IF (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.
T-DL = 0.00.
T-BILL = 0.00.
DISPLAY SPACE(9)
"R O L L I N G   V O L U M E   R E Q U E S T   S C R E E N (P)"
    SKIP(1) SPACE(20)
XCOM-N LABEL "COMPANY" SKIP(0) SPACE(20) XDIV-N LABEL "DIVISION"
SKIP(5) WITH FRAME A NO-BOX SIDE-LABELS.
REPEAT:
UPDATE BEG# D5 SKIP(0) BIRD-CRY SKIP(0) T-PRT WITH NO-BOX SIDE-LABELS.
IF BEG# = 2 THEN DO:
    D2 = D5 / 4.
    D3 = TRUNCATE(D2, 0).
    D4 = D3.
    IF D4 = D2 THEN L-YEAR = yes.
END.
IF BEG# = 1 THEN DO:
    UP-LIM = 31.
    H-MON = "JANUARY".
END.
IF BEG# = 2 AND L-YEAR THEN DO:
    UP-LIM = 29.
    H-MON = "FEBRUARY".
END.
IF BEG# = 2 AND NOT L-YEAR THEN DO:
    UP-LIM = 28.
    H-MON = "FEBRUARY".
END.
IF BEG# = 3 THEN DO:
    UP-LIM = 31.
    H-MON = "MARCH".
END.
IF BEG# = 4 THEN DO:
    UP-LIM = 30.
    H-MON = "APRIL".
END.
IF BEG# = 5 THEN DO:
    UP-LIM = 31.
    H-MON = "MAY".
END.
IF BEG# = 6 THEN DO:
    UP-LIM = 30.
    H-MON = "JUNE".
END.
IF BEG# = 7 THEN DO:
    UP-LIM = 31.
    H-MON = "JULY".
END.
IF BEG# = 8 THEN DO:
    UP-LIM = 31.
    H-MON = "AUGUST".
END.
IF BEG# = 9 THEN DO:
    UP-LIM = 30.
    H-MON = "SEPTEMBER".
END.
IF BEG# = 10 THEN DO:
    UP-LIM = 31.
    H-MON = "OCTOBER".
END.
IF BEG# = 11 THEN DO:
    UP-LIM = 30.
    H-MON = "NOVEMBER".
END.
IF BEG# = 12 THEN DO:
    UP-LIM = 31.
    H-MON = "DECEMBER".
END.
IF BEG# > 0 AND BEG# < 13 THEN LEAVE.
END.
IF LASTKEY = KEYCODE("F4") THEN LEAVE.
IF LASTKEY = KEYCODE("ESC") THEN LEAVE.
HIDE.
OUTPUT TO PRINTER.
    FOR EACH METPRO WHERE METPRO.COMP# = XCOM AND
			  METPRO.DIV# = XDIV
			  BY METPRO.C-NAME BY METPRO.PROPSL#:
    FIND FIRST ACCT-RCV WHERE ACCT-RCV.COMP# = XCOM AND
			ACCT-RCV.DIV# = XDIV AND
			ACCT-RCV.CUST# = METPRO.CUST# AND
			ACCT-RCV.C-STATUS <> "I" NO-ERROR.
    IF NOT AVAILABLE ACCT-RCV THEN NEXT.
    IF TODAY + 90 >= ACCT-RCV.EXPIRE-DT THEN EXP-CHECK = "***".
    ELSE EXP-CHECK = "".
    FOR EACH METDESC WHERE METDESC.COMP# = XCOM AND
			   METDESC.DIV# = XDIV AND
			   METDESC.CUST# = ACCT-RCV.CUST# AND
			   METDESC.PROPSL# = METPRO.PROPSL#
			   BY METDESC.ITEM#:
       FIND FIRST AR-DESP WHERE AR-DESP.COMP# = XCOM AND
				AR-DESP.DIV# = XDIV AND
				AR-DESP.CUST# = ACCT-RCV.CUST# AND
				AR-DESP.PROPSL# = METPRO.PROPSL# AND
				AR-DESP.ITEM# = METDESC.ITEM# NO-ERROR.
       IF NOT AVAILABLE AR-DESP
	   THEN HAR-DESP = "NO DESCRIPTION AVAILABLE".
       ELSE HAR-DESP = AR-DESP.DESC01.
IF NOT BIRD-CRY THEN DO:
      FORM HEADER TODAY FORMAT "99/99/9999"
      "ROLLING VOLUME LIST" AT 30 H-MON AT 70 SKIP(1)
      XCOM-N AT 01 XDIV-N AT 40 SKIP(1)
      "CUSTOMER" AT 1 "LOCATION" AT 36 "EXPIRE DATE" AT 60
      "CHK DT" AT 74 SKIP(0)
      "TICKET #" AT 1 "--PPC--" AT 61 "D/L" AT 76 SKIP(1)
      WITH FRAME X PAGE-TOP NO-BOX NO-LABELS NO-UNDERLINE.
      VIEW FRAME X.
END.
ELSE DO:
      FORM HEADER TODAY FORMAT "99/99/9999"
      "ROLLING VOLUME LIST" AT 30 H-MON AT 70 SKIP(1)
      XCOM-N AT 01 XDIV-N AT 40 SKIP(1)
      "CUSTOMER" AT 1 "LOCATION" AT 36 "EXPIRE DATE" AT 60
      "CHK DT" AT 74 SKIP(0)
      "BRIEF DESCRIPTION" AT 1 SKIP(0)
      "TICKET #" AT 1 "--PPC--" AT 61 "D/L" AT 76 SKIP(1)
      WITH FRAME Y PAGE-TOP NO-BOX NO-LABELS NO-UNDERLINE.
      VIEW FRAME Y.
END.
    PRIV = no.
    SECV = no.
    {RV-RPTS.I}.
    IF NOT SECV THEN DO:
    {RV-RPTP.I}.
    END.
 IF PRIV THEN DO:
    IF F-TICK THEN DO:
      REPEAT DY = 1 TO TICKS:
      T-DL = T-DL + METDESC.P-DL.
      T-BILL = T-BILL + METDESC.P-PPC.
      IF NOT T-PRT THEN DO:
      IF BIRD-CRY THEN DO:
      DISPLAY ACCT-RCV.C-NAME SPACE(4)
	      METPRO.L-NAME SPACE(6)
	      ACCT-RCV.EXPIRE-DT SPACE(4)
	      EXP-CHECK SKIP(0)
	      HAR-DESP SKIP(0)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
		FORMAT "X(25)" SPACE(30)
	      METDESC.P-PPC FORMAT "$->>>,>>>.99"
	      METDESC.P-DL FORMAT "$->>>,>>>.99" SKIP(1)
	      WITH FRAME PX NO-BOX NO-LABELS.
	  END.
	  ELSE DO:
      DISPLAY ACCT-RCV.C-NAME SPACE(4)
	      METPRO.L-NAME SPACE(6)
	      ACCT-RCV.EXPIRE-DT SPACE(4)
	      EXP-CHECK SKIP(0)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
		FORMAT "X(25)" SPACE(30)
	      METDESC.P-PPC FORMAT "$->>>,>>>.99"
	      METDESC.P-DL FORMAT "$->>>,>>>.99" SKIP(1)
	      WITH FRAME PQ NO-BOX NO-LABELS.
	  END.
	  END.
	 END.
	END.
      END.
     ELSE IF SECV THEN DO:
    IF F-TICK THEN DO:
      REPEAT DY = 1 TO TICKS:
      T-DL = T-DL + METDESC.S-DL.
      T-BILL = T-BILL + METDESC.S-PPC.
      IF NOT T-PRT THEN DO:
      IF BIRD-CRY THEN DO:
      DISPLAY ACCT-RCV.C-NAME SPACE(4)
	      METPRO.L-NAME SPACE(6)
	      ACCT-RCV.EXPIRE-DT SPACE(4)
	      EXP-CHECK SKIP(0)
	      HAR-DESP SKIP(0)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
		FORMAT "X(25)" SPACE(30)
	      METDESC.S-PPC FORMAT "$->>>,>>>.99"
	      METDESC.S-DL FORMAT "$->>>,>>>.99" SKIP(1)
	      WITH FRAME SX NO-BOX NO-LABELS.
	  END.
	  ELSE DO:
      DISPLAY ACCT-RCV.C-NAME SPACE(4)
	      METPRO.L-NAME SPACE(6)
	      ACCT-RCV.EXPIRE-DT SPACE(4)
	      EXP-CHECK SKIP(0)
	      STRING(METDESC.COMP#, ">>") + "-" +
	      TRIM(STRING(METDESC.DIV#, ">>")) + "-" +
	      TRIM(STRING(METDESC.CUST#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.PROPSL#, ">>>>>>>>>>")) + "-" +
	      TRIM(STRING(METDESC.ITEM#, ">>>>")) + "-" +
	      TRIM(STRING(BEG#, ">>")) + "-" +
	      TRIM(STRING(DY, ">>"))
		FORMAT "X(25)" SPACE(30)
	      METDESC.S-PPC FORMAT "$->>>,>>>.99"
	      METDESC.S-DL FORMAT "$->>>,>>>.99" SKIP(1)
	      WITH FRAME SQ NO-BOX NO-LABELS.
	  END.
	  END.
	 END.
	END.
      END.

    END.
  END.
IF T-PRT THEN DO:
      FORM HEADER "ROLLING VOLUME LIST" AT 30 H-MON AT 70 SKIP(1)
      XCOM-N AT 01 XDIV-N AT 40 SKIP(1)
      "CUSTOMER" AT 1 "LOCATION" AT 36 "EXPIRE DATE" AT 60
      "CHK DT" AT 74 SKIP(0)
      "TICKET #" AT 1 "--PPC--" AT 61 "D/L" AT 76 SKIP(1)
      WITH FRAME XX PAGE-TOP NO-BOX NO-LABELS NO-UNDERLINE.
      VIEW FRAME XX.
 END.
      DISPLAY SKIP(1) SPACE(51) T-BILL T-DL WITH NO-BOX NO-LABELS.
