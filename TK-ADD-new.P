/*************************************************/
/* tk-add.p                                      */
/*                                               */
/* Add 1 monthly ticket                          */
/*                                               */
/*  04/02/2018   TO    Added laser print option  */
/*                     Added test mode flag      */
/*                                               */
/*************************************************/

DEFINE SHARED VARIABLE XCOM AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XDIV AS INTEGER FORMAT "ZZ".
DEFINE SHARED VARIABLE XCOM-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XDIV-N AS CHAR FORMAT "X(30)".
DEFINE SHARED VARIABLE XOPR AS CHAR FORMAT "XXX".
DEF SHARED VAR XPROG AS LOGICAL.

DEFINE NEW SHARED VARIABLE TestMode AS LOG INIT Yes.

DEFINE NEW SHARED VARIABLE ProcessMonth AS INTEGER FORMAT "ZZ"
  LABEL "ENTER MONTH & YEAR FOR WHICH YOU WANT TO RUN TICKETS".
DEFINE NEW SHARED VARIABLE ProcessYear AS INTEGER FORMAT "9999" LABEL "YEAR (4 DIGITS)".
DEFINE NEW SHARED VARIABLE MonthDays AS INTEGER FORMAT "99".
DEFINE NEW SHARED VARIABLE F-CUST AS DECIMAL FORMAT "ZZZZZZZZZZ"
    LABEL "CUSTOMER NUMBER".
DEFINE NEW SHARED VARIABLE F-PROP AS DECIMAL FORMAT "ZZZZZZZZZZ"
    LABEL "PROPOSAL NUMBER".
DEFINE NEW SHARED VARIABLE F-ITEM AS INTEGER FORMAT "ZZZZ"
    LABEL "ITEM NUMBER".
DEFINE NEW SHARED VARIABLE F-INDEX AS INTEGER FORMAT "ZZ"
    LABEL "TICK INDEX".

{include\stdutils.i}

IF (USERID = "OPERATIONS") OR (USERID = "LANDMARK") OR (USERID = "GARCIA")
THEN DO:
    MESSAGE "YOU ARE NOT AUTHORIZED TO RUN THIS PROCEDURE".
    RETURN.
END.

REPEAT:
   OUTPUT TO TERMINAL.
   DISPLAY SPACE(11)
      "S I N G L E   T I C K E T   R E Q U E S T   S C R E E N (tk-add.p)"
      SKIP(1) SPACE(20)
      XCOM-N LABEL "COMPANY" SKIP(0) SPACE(20)
      XDIV-N LABEL "DIVISION" SKIP(0) SPACE(20)
      XOPR LABEL "OPERATOR"
      SKIP(5) 
         WITH FRAME A NO-BOX SIDE-LABELS.

   IF LASTKEY = KEYCODE("F4") THEN LEAVE.
   IF LASTKEY = KEYCODE("ESC") THEN LEAVE.

   REPEAT:
      IF LASTKEY = KEYCODE("F4") THEN LEAVE.
      IF LASTKEY = KEYCODE("ESC") THEN LEAVE.
      
      UPDATE 
        ProcessMonth 
        ProcessYear SKIP(1) 
        WITH FRAME A NO-BOX SIDE-LABELS.
      UPDATE SKIP(1) 
         F-CUST 
         F-PROP SKIP(0)
	  F-ITEM 
	  F-INDEX 
	     WITH FRAME A NO-BOX SIDE-LABELS.
      
      IF LASTKEY = KEYCODE("F4") THEN LEAVE.
      IF LASTKEY = KEYCODE("ESC") THEN LEAVE.
      
      MonthDays = DaysInMonth(ProcessMonth,ProcessYear).

      IF LASTKEY = KEYCODE("F4") THEN LEAVE.
      IF LASTKEY = KEYCODE("ESC") THEN LEAVE.
      
   END.
   IF LASTKEY = KEYCODE("F4") THEN LEAVE.
   IF LASTKEY = KEYCODE("ESC") THEN LEAVE.

   IF NOT XPROG THEN RUN TK-ADDR.P.
   IF XPROG THEN RUN TK-ADDRP.P.
END.
